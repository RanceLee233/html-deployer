# 数据库更新指南

## 重要变更

本项目已从直接存储HTML代码的方式，改为使用**哈希值存储**架构，解决了以下问题：

1. **解决Notion字段2000字符限制问题**
2. **实现真正的分享链接功能**
3. **支持任意大小的HTML内容**

## Notion数据库更新步骤

### 1. 更新数据库结构

你需要更新Notion数据库的属性名称：

**原结构：**
- 页面标题 (Title)
- HTML代码 (Text) ← **删除此字段**
- 描述 (Text)
- 创建时间 (Created Time)

**新结构：**
- 页面标题 (Title)
- HTML哈希值 (Text) ← **新增此字段**
- 描述 (Text)
- 创建时间 (Created Time)
- 页面ID (Text) ← **新增此字段**
- 分享链接 (Text) ← **新增此字段**

### 2. 具体操作步骤

1. 打开你的Notion数据库
2. 删除原有的"HTML代码"属性
3. 添加新属性：
   - **HTML哈希值**: 文本类型
   - **页面ID**: 文本类型
   - **分享链接**: 文本类型

### 3. 现有数据处理

对于现有的页面数据：
- 原有的HTML代码字段将被忽略
- 建议重新部署重要页面以使用新架构
- 旧页面仍可通过ID访问，但建议迁移

## 新功能特性

### 分享链接
每个页面现在都有一个独立的分享链接，格式：
```
https://your-domain.com/view/{hash-value}
```

### 无限内容支持
不再受2000字符限制，可以存储任意大小的HTML内容。

### 一键复制分享
前端界面新增了"复制链接"按钮，方便分享页面。

## 技术架构变化

### 存储方式
- **之前**: HTML代码直接存储在Notion中
- **现在**: 使用MD5哈希值作为文件名，存储在服务器文件系统中

### 数据流程
1. 用户提交HTML内容
2. 后端生成MD5哈希值
3. HTML内容保存为文件：`html_storage/{hash}.html`
4. 哈希值存储到Notion数据库
5. 访问时通过哈希值读取对应文件

## 部署注意事项

### Vercel部署
- 文件系统存储在`/tmp`目录（Vercel的无服务器环境）
- 哈希值具有良好的持久性
- 支持水平扩展

### 本地开发
- 文件存储在项目根目录的`html_storage/`文件夹中
- 确保该目录有写入权限

## 迁移建议

对于生产环境：
1. 创建新的Notion数据库使用新结构
2. 逐步迁移重要页面
3. 测试分享链接功能
4. 更新环境变量配置

## 故障排除

### 常见问题

1. **页面404错误**
   - 检查文件是否存在：`html_storage/{hash}.html`
   - 确认哈希值正确

2. **权限问题**
   - 确保服务器有写入权限
   - 检查存储目录是否存在

3. **数据库连接错误**
   - 验证NOTION_API_KEY和NOTION_DATABASE_ID
   - 确认数据库属性名称拼写正确

## 联系支持

如有问题，请检查服务器日志或联系开发团队。